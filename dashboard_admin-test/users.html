<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management - Admin Panel</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ–ï¸ Resort Admin</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item">
                    <span class="icon">ğŸ“Š</span>
                    <span class="text">Dashboard</span>
                </a>
                <a href="users.html" class="nav-item active">
                    <span class="icon">ğŸ‘¥</span>
                    <span class="text">User Management</span>
                </a>
                <a href="resorts.html" class="nav-item">
                    <span class="icon">ğŸ¨</span>
                    <span class="text">Resort</span>
                </a>
                <a href="bookings.html" class="nav-item">
                    <span class="icon">ğŸ“…</span>
                    <span class="text">Booking</span>
                </a>
                <a href="interactions.html" class="nav-item">
                    <span class="icon">ğŸ’¬</span>
                    <span class="text">Interaction</span>
                </a>
                <a href="reports.html" class="nav-item">
                    <span class="icon">ğŸ“ˆ</span>
                    <span class="text">Reports</span>
                </a>
                <a href="settings.html" class="nav-item">
                    <span class="icon">âš™ï¸</span>
                    <span class="text">Settings</span>
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <span class="icon">ğŸšª</span>
                    <span class="text">Logout</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="topbar">
                <div class="topbar-left">
                    <h1>User Management</h1>
                </div>
                <div class="topbar-right">
                    <div class="notification">
                        <span class="icon">ğŸ””</span>
                        <span class="badge">3</span>
                    </div>
                    <div class="user-profile">
                        <span class="user-name">Admin</span>
                        <span class="user-avatar">ğŸ‘¤</span>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <div class="card">
                    <div class="card-header">
                        <h3>Daftar User</h3>
                        <button class="btn btn-primary" onclick="openUserModal()">
                            â• Tambah User
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-controls">
                            <input type="text" id="searchUser" placeholder="ğŸ” Cari user..." class="search-input">
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>Email</th>
                                    <th>Telepon</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <tr>
                                    <td colspan="7" class="text-center">Memuat data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah/Edit User -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Tambah User</h2>
                <span class="close" onclick="closeUserModal()">&times;</span>
            </div>
            <form id="userForm" class="modal-body">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label for="userName">Nama Lengkap *</label>
                    <input type="text" id="userName" required>
                </div>
                <div class="form-group">
                    <label for="userEmail">Email *</label>
                    <input type="email" id="userEmail" required>
                </div>
                <div class="form-group">
                    <label for="userPhone">Telepon *</label>
                    <input type="tel" id="userPhone" required>
                </div>
                <div class="form-group">
                    <label for="userRole">Role *</label>
                    <select id="userRole" required>
                        <option value="Customer">Customer</option>
                        <option value="Admin">Admin</option>
                        <option value="Manager">Manager</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="userStatus">Status *</label>
                    <select id="userStatus" required>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Suspended">Suspended</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeUserModal()">Batal</button>
                    <button type="submit" class="btn btn-primary">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/script.js"></script>
    <script>
        checkAuth();
        let users = [];
        let editingUserId = null;

        // Load users on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
            
            // Search functionality
            document.getElementById('searchUser').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = users.filter(u => 
                    u.name.toLowerCase().includes(searchTerm) || 
                    u.email.toLowerCase().includes(searchTerm)
                );
                displayUsers(filtered);
            });

            // Form submit
            document.getElementById('userForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveUser();
            });
        });

        function loadUsers() {
            const stored = localStorage.getItem('users');
            if (stored) {
                users = JSON.parse(stored);
            } else {
                // Sample data
                users = [
                    { id: 1, name: 'John Doe', email: 'john@example.com', phone: '081234567890', role: 'Customer', status: 'Active' },
                    { id: 2, name: 'Jane Smith', email: 'jane@example.com', phone: '081234567891', role: 'Customer', status: 'Active' },
                    { id: 3, name: 'Admin User', email: 'admin@resort.com', phone: '081234567892', role: 'Admin', status: 'Active' }
                ];
                localStorage.setItem('users', JSON.stringify(users));
            }
            displayUsers(users);
        }

        function displayUsers(data) {
            const tbody = document.getElementById('userTableBody');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">Tidak ada data</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone}</td>
                    <td><span class="badge badge-info">${user.role}</span></td>
                    <td><span class="badge badge-${user.status === 'Active' ? 'success' : user.status === 'Inactive' ? 'warning' : 'danger'}">${user.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editUser(${user.id})">âœï¸ Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">ğŸ—‘ï¸ Hapus</button>
                    </td>
                </tr>
            `).join('');
        }

        function openUserModal() {
            editingUserId = null;
            document.getElementById('modalTitle').textContent = 'Tambah User';
            document.getElementById('userForm').reset();
            document.getElementById('userId').value = '';
            document.getElementById('userModal').style.display = 'flex';
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (!user) return;

            editingUserId = id;
            document.getElementById('modalTitle').textContent = 'Edit User';
            document.getElementById('userId').value = user.id;
            document.getElementById('userName').value = user.name;
            document.getElementById('userEmail').value = user.email;
            document.getElementById('userPhone').value = user.phone;
            document.getElementById('userRole').value = user.role;
            document.getElementById('userStatus').value = user.status;
            document.getElementById('userModal').style.display = 'flex';
        }

        function saveUser() {
            const id = editingUserId || Date.now();
            const userData = {
                id: id,
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                phone: document.getElementById('userPhone').value,
                role: document.getElementById('userRole').value,
                status: document.getElementById('userStatus').value
            };

            if (editingUserId) {
                const index = users.findIndex(u => u.id === editingUserId);
                users[index] = userData;
            } else {
                users.push(userData);
            }

            localStorage.setItem('users', JSON.stringify(users));
            displayUsers(users);
            closeUserModal();
            alert('User berhasil disimpan!');
        }

        function deleteUser(id) {
            if (confirm('Apakah Anda yakin ingin menghapus user ini?')) {
                users = users.filter(u => u.id !== id);
                localStorage.setItem('users', JSON.stringify(users));
                displayUsers(users);
                alert('User berhasil dihapus!');
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('userModal');
            if (event.target === modal) {
                closeUserModal();
            }
        }
    </script>
</body>
</html>