<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chart Line - Total Pendapatan</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #f9fafb;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .header h1 {
      font-size: 24px;
      color: #1f2937;
      margin-bottom: 4px;
    }

    .header p {
      color: #6b7280;
      font-size: 14px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .stat-card h3 {
      font-size: 14px;
      color: #6b7280;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .stat-card .value {
      font-size: 28px;
      color: #1f2937;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .stat-card .change {
      font-size: 14px;
      font-weight: 600;
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
    }

    .stat-card .change.positive {
      color: #059669;
      background: #d1fae5;
    }

    .stat-card .change.negative {
      color: #dc2626;
      background: #fee2e2;
    }

    .chart-container {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: relative;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .chart-title {
      font-size: 18px;
      color: #1f2937;
      font-weight: 600;
    }

    .period-toggle {
      display: flex;
      gap: 0;
      background: #e0f2f1;
      border-radius: 8px;
      padding: 4px;
    }

    .period-btn {
      padding: 8px 20px;
      border: none;
      background: transparent;
      color: #1f2937;
      font-size: 14px;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .period-btn:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    .period-btn.active {
      background: #1f2937;
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .chart-wrapper {
      position: relative;
      height: 380px;
    }

    #lineChart {
      max-height: 380px !important;
    }

    @media (max-width: 640px) {
      .chart-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .period-toggle {
        width: 100%;
      }

      .period-btn {
        flex: 1;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>Dashboard Pendapatan</h1>
      <p id="periodInfo">Pendapatan Tahunan 2024 (Januari - Desember)</p>
    </div>

    <!-- Statistik Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Total Pendapatan</h3>
        <div class="value" id="totalRevenue">-</div>
      </div>
      
      <div class="stat-card">
        <h3 id="averageLabel">Rata-rata per Bulan</h3>
        <div class="value" id="averageRevenue">-</div>
      </div>
      
      <div class="stat-card">
        <h3>Perubahan</h3>
        <div class="value" id="revenueChange">-</div>
        <span class="change" id="revenueChangeLabel">vs periode awal</span>
      </div>
    </div>

    <!-- Chart -->
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">Tren Pendapatan</div>
        <div class="period-toggle">
          <button class="period-btn" id="btnWeekly" data-period="weekly">Mingguan</button>
          <button class="period-btn" id="btnMonthly" data-period="monthly">Bulanan</button>
          <button class="period-btn active" id="btnYearly" data-period="yearly">Tahunan</button>
        </div>
      </div>
      <div class="chart-wrapper">
        <canvas id="lineChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    // Data Chart Line
    const chartData = {
      // Mingguan: Senin - Minggu (7 hari)
      weekly: {
        labels: ["Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu", "Minggu"],
        data: [3200000, 2800000, 3500000, 4100000, 3900000, 5200000, 6800000],
        period: "Pendapatan Mingguan (7 Hari Terakhir)",
      },
      
      // Bulanan: Per Range Tanggal
      monthly: {
        labels: ["1-7 Des", "8-14 Des", "15-21 Des", "22-31 Des"],
        data: [18500000, 22300000, 19800000, 24100000],
        period: "Pendapatan Desember 2024",
      },
      
      // Tahunan: 12 Bulan Penuh
      yearly: {
        labels: ["Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Agt", "Sep", "Okt", "Nov", "Des"],
        data: [58200000, 54300000, 61800000, 59400000, 63700000, 67200000, 72500000, 68750000, 72300000, 69200000, 65800000, 84600000],
        period: "Pendapatan Tahunan 2024 (Januari - Desember)",
      }
    };

    let currentPeriod = 'yearly';
    let lineChart;

    // Config Chart Line
    function createChartConfig(period) {
      const data = chartData[period];
      
      return {
        type: "line",
        data: {
          labels: data.labels,
          datasets: [
            {
              label: "Total Pendapatan",
              data: data.data,
              borderColor: "#14b8a6",
              backgroundColor: "rgba(20, 184, 166, 0.1)",
              borderWidth: 3,
              tension: 0.4,
              fill: true,
              pointRadius: 5,
              pointHoverRadius: 7,
              pointBackgroundColor: "#14b8a6",
              pointBorderColor: "#ffffff",
              pointBorderWidth: 2,
              pointHoverBackgroundColor: "#14b8a6",
              pointHoverBorderColor: "#ffffff",
              pointHoverBorderWidth: 3,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          font: {
            family: "'Inter', sans-serif",
            weight: "500",
          },
          
          plugins: {
            legend: {
              display: true,
              position: "top",
              align: "end",
              onClick: null,
              labels: {
                usePointStyle: true,
                pointStyle: "circle",
                boxWidth: 8,
                boxHeight: 8,
                padding: 20,
                font: {
                  size: 13,
                  family: "'Inter', sans-serif",
                  weight: "500",
                },
                color: "#6b7280",
              },
            },

            tooltip: {
              backgroundColor: "#1f2937",
              padding: 16,
              titleFont: {
                size: 13,
                family: "'Inter', sans-serif",
                weight: "600",
              },
              bodyFont: {
                size: 13,
                family: "'Inter', sans-serif",
                weight: "400",
              },
              displayColors: true,
              boxWidth: 12,
              boxHeight: 12,
              boxPadding: 6,
              callbacks: {
                title: function (tooltipItems) {
                  return tooltipItems[0].label;
                },
                label: function (context) {
                  const value = context.parsed.y;
                  const formatted = new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0,
                  }).format(value);
                  return ` ${context.dataset.label}: ${formatted}`;
                },
              },
            },
          },

          scales: {
            x: {
              grid: {
                display: false,
              },
              ticks: {
                color: "#6b7280",
                font: {
                  size: 13,
                  family: "'Inter', sans-serif",
                },
              },
            },

            y: {
              beginAtZero: true,
              grid: {
                color: "#f3f4f6",
                drawBorder: false,
              },
              ticks: {
                color: "#6b7280",
                font: {
                  size: 12,
                  family: "'Inter', sans-serif",
                },
                callback: function(value) {
                  if (value >= 1000000) {
                    return 'Rp ' + (value / 1000000) + 'jt';
                  }
                  return 'Rp ' + (value / 1000) + 'rb';
                },
              },
            },
          },

          interaction: {
            mode: "index",
            intersect: false,
          },
        },
      };
    }

    // Render Chart
    const lineContext = document.getElementById("lineChart");
    lineChart = new Chart(lineContext, createChartConfig(currentPeriod));

    // Function untuk menghitung statistik
    function calculateRevenueStats(period) {
      const data = chartData[period].data;
      
      // Total Pendapatan
      const total = data.reduce((sum, val) => sum + val, 0);
      document.getElementById("totalRevenue").textContent = 
        new Intl.NumberFormat('id-ID', {
          style: 'currency',
          currency: 'IDR',
          minimumFractionDigits: 0,
        }).format(total);
      
      // Rata-rata
      const average = total / data.length;
      document.getElementById("averageRevenue").textContent = 
        new Intl.NumberFormat('id-ID', {
          style: 'currency',
          currency: 'IDR',
          minimumFractionDigits: 0,
        }).format(average);
      
      // Update label rata-rata
      let averageLabel = "Rata-rata";
      if (period === 'weekly') averageLabel = "Rata-rata per Hari";
      else if (period === 'monthly') averageLabel = "Rata-rata per Minggu";
      else if (period === 'yearly') averageLabel = "Rata-rata per Bulan";
      
      document.getElementById("averageLabel").textContent = averageLabel;
      
      // Persentase Perubahan
      const firstPeriod = data[0];
      const lastPeriod = data[data.length - 1];
      const changePercent = (((lastPeriod - firstPeriod) / firstPeriod) * 100).toFixed(1);
      
      document.getElementById("revenueChange").textContent = 
        (changePercent > 0 ? "+" : "") + changePercent + "%";
      
      // Styling
      const changeLabel = document.getElementById("revenueChangeLabel");
      if (changePercent > 0) {
        changeLabel.classList.add("positive");
        changeLabel.classList.remove("negative");
      } else {
        changeLabel.classList.add("negative");
        changeLabel.classList.remove("positive");
      }

      // Update periode info
      document.getElementById("periodInfo").textContent = chartData[period].period;
    }

    // Switch Period Function
    function switchPeriod(period) {
      currentPeriod = period;
      
      // Update button active state
      document.querySelectorAll('.period-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      if (period === 'weekly') document.getElementById('btnWeekly').classList.add('active');
      else if (period === 'monthly') document.getElementById('btnMonthly').classList.add('active');
      else if (period === 'yearly') document.getElementById('btnYearly').classList.add('active');
      
      // Update chart
      lineChart.data.labels = chartData[period].labels;
      lineChart.data.datasets[0].data = chartData[period].data;
      lineChart.update('active');
      
      // Update stats
      calculateRevenueStats(period);
    }

    // Event Listeners
    document.getElementById('btnWeekly').addEventListener('click', () => switchPeriod('weekly'));
    document.getElementById('btnMonthly').addEventListener('click', () => switchPeriod('monthly'));
    document.getElementById('btnYearly').addEventListener('click', () => switchPeriod('yearly'));

    // Initial calculation
    calculateRevenueStats(currentPeriod);
  </script>
</body>
</html>